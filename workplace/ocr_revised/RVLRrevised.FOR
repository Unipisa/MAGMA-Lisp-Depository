C     Revised to start understanding it: body at the head, exits at the bottom. Comments added.
C
      INTEGER FUNCTION RVLR(KEY,PUNT)
C
C RETURNS THE VALUE IN CONTEXT KEY FROM RVL PUNT
C MAY MODIFY PUNT - HOW AND WHY?
C
      IMPLICIT INTEGER(A-Z)
      INTEGER*2 R,S
C	
      COMMON
     */ UNIT / UNIT
     */ CAR / V(4),CAR(15767)
     */ CDR / B(4),CDR(15767)
     */ R / C(3),R(128)
     */ S / F(3),S(128)
     */ NIL / NIL
C ARGUMENT CHECK
      IP(PUNT.EQ.NIL) GO TO 5
C PUNT IS A PROPER POINTER
      PUNTEM = PUNT
C PUNT SAVED TO UNDO A SIDE EFFECT?
C
C LOOP TO SKIP LESSER CONTEXTS
      RKEY = R(KEY)
2     RK = CAR(CAR(PUNT))
      IF(RKEY.GE.R(RK)) GO TO 3
      PUNT = CDR(PUNT)
      IF(PUNT.EQ.NIL) GO TO 5
      GOTO 2
C POSSIBLE EXACT CANDIDATE
3     IF(RKEY.EQ.R(RK)) GO TO 20
C LOOP FOR GREATER CONTEXT
4     IF(S(KEY).LE.S(RK)) GO TO 10
      PUNT = CDR(PUNT)
      IF(PUNT.EQ.NIL) GO TO 5
      RK = CAR(CAR(PUNT))
      GO TO 4
C EXACT CANDIDATE - PUNT MODIFIED
20    RVLR = CDR(CAR(PUNT))
      PUNT = CDR(PUNT)
      RETURN
C GREATER CONDIDATE - PUNT RESTORED
10    RVLR = CDR(CAR(PUNT))
      PUNT = PUNTEM
      RETURN
C ABORT
5     WRITE(UNIT,100)
100   FORMAT(1X,'RVLR - FATAL SYSTEM ERROR')
      CALL HLT
      END
