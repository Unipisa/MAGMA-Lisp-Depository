C     RACCOLTA DEGLI ATOMI
C
      SUBROUTINE CAT
      IMPLICIT INTEGER(A-Z)
      DOUBLE PRECISION PRINO,NPRINA,PUNTI
      COMMON
     */NTYPEE/ NTYPEE
     */ ALIST / ALIST (128)
     */ APUNT / APU,APUNT(1023)
     */ ATNAME / ATN,ATNAME(1023)
     */ ATMLUN / ATMLUN
     */ LIBAT / LIBAT
     */ LZATOM /LZATOM
     */ PUNTI / PUNTI(4)
     */VALUE/A1(4),VALUE(1023)
     */NPRINA/A4(4),PRINO,NPRINA(1023)
     */KAT/KAT
     */SYSAT/ SYSAT(30)
     */KGBC / KGBC
      DATA M2/Z7FFFFFFF/, M1 /Z80000000/
C
C
C--XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX
C   SI FORZA LA MARCA DI NON RACCOLTA
C   SU ALCUNI ATOMI .
C--XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX
C
      DO 560 K = 1,30
124   IF(SYSAT(K).EQ.0) GOTO 125
      KK=MOD(SYSAT(K),NTYPEE)
      VALUE(KK)=IOR(VALU(KK),M1)
560   CONTINUE
C
C--XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX
C   SGANCIAMENTO ATOMI LIBERI
C   RICOSTRUZIONE LISTA ATOMI UTILI
C--XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX
C
125   DO 10 J = 1,128
      KK = -1
      I = ALIST(J)
20    IF(I.EQ.-1) GO TO 10
25    IF(VALUE(I).GT.0) GO TO 30
      IF(KK.NE.-1) GOTO 40
      ALIST(J)=I
      GOTO 45
40    APUNT(KK)=I
45    KK = I
      I = APUNT(I)
      GO TO 20
30    IF(KK.EQ.-1) GOTO 12
      IF(APUNT(I).NE.-1) GOTO 13
      APUNT(KK)=-1
      GOTO 10
12    IF(APUNT(I).NE.-1) GOTO 13
      ALIST(J)=-1
      GOTO 10
13    I=APUNT(I)
      GOTO 25
10    CONTINUE
C
C
C--XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX
C   RICOSTRUZIONE LISTA LIBERA
C   ELIMINAZIONE MARCA
C--XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX
C
      KAT = C
      DO 110 J = 1,LZATOM
      I = J-1
      IF(VALUE(I).LT.0) GO TO 130
      IF(KAT.NE.0) GO TO 120
      LIBAT = I
115   KK = I
      KAT = KAT+1
      IND = ATNAME(I)
      CALL ASSBLK(NPRINA(IND),ATMLUN)
      GO TO 110
120   APUNT(KK)
      GO TO 115
130   VALUE(I) = IAND(VALUE(I),M2)
110   CONTINUE
C
C
C--XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX
C   RICOSTRUZIONE CUSCINETTO
C--XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX
C
      IF(KAT.LT.10) GO TO 150
      J = 9
      KK = LIBAT
      K1 = KAT-10
      IF(K1.EQ.0) GO TO 202
      DO 200 I = 1,K1
200   KK = APUNT(KK)
C
202   DO 201 I = 1,J
      IND = ATNAME(KK)
      CALL ASSIGN(NPRINA(IND),PUNTI,ATMLUN)
201   KK = APUNT(KK)
C
      IND = ATNAME(KK)
      CALL ASSIGN(NPRINA(IND),PUNTI,ATMLUN)
      APUNT(KK) = -2
      GO TO 561
C
C--XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX
C   FALLIMENTO NELLA COSTRUZIONE DEL
C   CUSCINETTO
C--XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX
C
150   KGBC = 1
561   RETURN
      END
