C     MARCATURA S-ESPRESSIONI
C
      SUBROUTINE MARCA(PO)
      IMPLICIT INTEGER(A-Z)
      INTEGER*2 ATOMT,NAPPID,COMPT,ARRAYT
      COMMON /CAR/A(4),CAR(5000)
      COMMON /CDR/B(4),CDR(5000)
      COMMON /VALUE/C(4),VALUE(1023)
      COMMON
     */NIL/NIL/NAPPID/NAPPID
     */COMPT/COMPT/ARRAYT/ARRAYT
     */BINSP/BINSPL,BINSPO,BINSP(1023)
     */ATOMT/ATOMT
     */NTYPEE/NTYPEE
      DATA M1/Z80000000/
      DATA M2/Z7FFFFFFF/
      T=M2
      P=PO
C     WRITE (6,997) P
997   FORMAT(' MARCA',Z8)
      IF(PO/NTYPEE.EQ.0) GOTO 101
      WRITE(6,102)
102   FORMAT(' SYSTEM ERROR-MARCA')
      CALL HLT
101   IF (CAR(P).LT.O) GO TO 40
10    CARL=CAR(P)
      CAR(P)=IOR(CAR(P),M 1)
      IF(CARL.EQ.NIL) GO TO 20
      K=MOD(CARL,NTYPEE)
      MAR=CARL/NTYPEE
C     WRITE(6,999)P,K,MAR
999   FORMAT (' M1',Z8,I3,I8)
      IF(MAR.EQ.O) GO TO 50
      IF(MAR.EQ.ATOMT) GOTO 111
      IF(MAR.EQ.NAPPID) GOTO 110
      IF(MAR.EQ.COMPT.OR.MAR.EQ.ARRAYT) GOTO 112
      GOTO 20
110   CAR(K)=IOR(CAR(K),M1)
      GOTO 20
111   VALUE(K)=IOR(VALUE(K),M1)
      GO TO 20
112   BINSP(K)=IOR(BINSP(K),M1)
      GOTO 20
50    Q=CARL
      IF(CAR(Q).LT.0) GO TO 20
      CDR(P)=IOR(CDR(P),M1)
      CAR(P)=IOR(T,M1)
      T=P
      P=0
      GO TO 10
20    CDRL=IAND(CDR(P),M2)
      IF(CDRL.EQ.NIL) GOTO 30
      K=MOD(CDRL,NTYPEE)
      MAR=CDRL/NTYPEE
C     WRITE(6,998)P,K,MAR
998   FORMAT(' M2',Z8,I3,I8)
      IF(MAR.EQ.0) GO TO 60
      IF(MAR.EQ.ATOMT) GOTO 121
      IF(MAR.EQ.NAPPID) GOTO 122
      IF(MAR.EQ.COMPT.OR.MAR.EQ.ARRAYT) GOTO 123
      GOTO 30
121   VALUE(K)=IOR(VALUE(K),M1)
      GO TO 30
122   CAR(K)=IOR(CAR(K),M1)
      GOTO 30
123   BINSP(K)=TOR(BINSP(K),M1)
      GOTO 30
60    Q=CDRL
      IF(CAR(Q).LT.0) GO TO 30
      CDR(P) =T
      T=P
      P=Q
      GO TO 10
30    IF(T.EQ.M2) GO TO 40
      Q =T
      IF(CDR(Q).LT.0) GO TO 35
      T=CDR(Q)
      CDR(Q)=P
32    P=Q
      GO TO 30
35    CDR(Q)=IAND(CDR(Q),M2)
      T=IAND(CAR(Q),M2)
      CAR(Q)=IOR(P,M1)
      P=Q
      GO TO 20
40    CONTINUE
      RETURN
      END
