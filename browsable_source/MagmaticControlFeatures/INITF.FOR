      SUBROUTINE INITF
C
      IMPLICIT INTEGER(A-Z)
      COMMON / KK1 / KK 1
      COMMON / NUMCXT / NUMCXT
CSTAT
CSTAT      COMMON /CONTIN/CONTIN
      COMMON / PUNOUT / PUNOT
      COMMON / CONTAP / CONTAP
      COMMON /RESTAR/ RESTAR
C
      INTEGER*2
     *CXT,KEY,UNO,COMPT,ARRAYT,
     *LISTT,BASEFT,COMMAT,NLAMBD,NNAMBD,ATOMT,NAPPID,REDEFT,
     *CXTT,STR,TUPLE,CLASS,BAG,LNUM,SNUM,RUNO,NREDMO,
     *R,S,CXTX,PADRE,FIRSTS,FIRSTB,LIST,LIB,L,FAPMT,
     *ACXT,CXTC,AAK,RADIX,RRADIX
      DOUBLE PRECISION
     *PUNTI,NPRINA,PRINO,NBLANK,PLATO
C
C
      COMMON
C     */ ABLOCK / V1(3),ABLOCK (2568)
C     */ABLOCK/V1(3),ABLOCK (5136)
     */ABLOCK/V1(3),ABLOCK(7704)
C     */BBLOCK/V2(3),BBLOCK(3072)
C     */BBLOCK/V2(3),BBLOCK(6144)
     */BBLOCK/V2(3),BBLOCK(9616)
C     */CBLOCK/V3(3),CBLOCK(4096)
C     */CBLOCK/V3(3),CBLOCK(8192)
     */CBLOCK/V3(3),CBLOCK(12288)
     */ FLA / FLA
     */ FLB / FLB
     */ FLC / FLC
     */ NAPPOI / NAPPOI
     */ BPOINT / BPOINT
     */ CPOINT / CPOINT
     */ ISW1 / ISW1
     */ OSW1 / OSW1
C
      COMMON
     */ NIL / NIL
     */ NOBIND / NOBIND
     */ LAMBDA / LAMBDA
     */ LISPX / LISPX
     */ ERRORX / ERRORX
     */ PROG / PROG
     */ QUOTE / QUOTE
     */ T / T
     */ EOP / EOF
     */ DDNARG / DDNARG
C
      COMMON
     */ EOR / EOR
     */ PROGN / PROGN
     */NLAMBA / NLAMBA
     */FAULTV / FAULTV
     */ERREXP / ERREXP
     */ERRORN / ERRORN
     */MCONS / MCONS
     */MEVAL / MEVAL
     */ZNIL / ZNIL
     */DCLV / DCLV
C
C
      COMMON
     */ LISTT / LISTT
     */ BASEFT / BASEFT
     */ COMMAT / COMMAT
     */ NLAMBD / NLAMBD
     */ ATOMT / ATOMT
     */ NNAMBD / NNAMBD
     */ NAPPID / NAPPID
     */ REDEFT / REDEFT
     */ CXTT / CXTT
     */ COMPT /COMPT
     */ ARRAYT / ARRAYT
     */ STR / STR   
     */ TUPLE / TUPLE
     */ CLASS / CLASS
     */ BAG / BAG
     */ LNUM / LNUM
     */ SNUM / SNUM
C
C
      COMMON
     */ ALMODE / ALMODE
     */ FLAG / FLAG
     */BUFLAG /BUFLAG
     */ UNNO / UNNO
     */ NTYPEE / NTYPEE
     */ ATOMT1 / ATOMT1
     */ NATOML / NATOML
     */ UNNO2 / UNNO2
     */ RUNO / RUNO
C
      COMMON
     */ NREDMO / NREDMO
     */ STRC / STRC
     */ COMMAM / COMMAM
     */ BASEFM / BASEFM
C
      COMMON
     */ CXT / D1(3),CXT(256)
     */ KEY / D2(3),KEY(256)
     */ R / F1(3),R(128)
     */ F2(3),S(128)
     */ CXTX / F3(3), CXTX(128)
     */ PADRE / F4(3),PADRE(128)
     */ FIRSTS / F5(3),FIRSTS (128)
     */ FIRSTB / F6(3),FIRSTB(128)
     */ LIST / F7(3),LIST(128)
     */ LIB / LIB
     */ ACXT / ACXT
     */ CXTC / CXTC
     */ AAK / AAK
     */PPDEM / PPDEM
     */CXTM / CXTM
     */ RADIX / RADIX
     */ RRADIX / RRADIX
C
      COMMON
     */ L / L
     */ CPLIST / BBC(3),CPLIST (128)
     */ FAPHT / FAPMT
C
      COMMON
     */ BASE / BASE
     */ EXES / EXES
     */ LGN / A1(4),LGN(1023)
C
      COMMON
     */ CAR / B1(4),CAR(40000)
     */ CDR / B2(4),CDR(40000)
     */ FSSIZE / FSSIZE
     */ASIZE/ASIZE
     */BSIZE/BSIZE  /CSIZE/CSIZE
     */ FLFS / FLPS
C
      COMMON
     */ VALUE / B3(4),VALUE(2047)
     */ FDEF / B4(4),FDEP(2047)
     */ PLIST / B5(4),PLIST(2047)
     */ NPRINA / B6(4), PRINO, NPRINA(6143)
     */LENGTH/LENGTH
     */LZATOM / LZATOM
     */ATOMO/ PLATO(4)
     */ PUNTI / PUNTI (4)
     */SYSAT / SYSAT (30)
     */ ALIST / ALIST (128)
     */ APUNT / AAAPUN,APUNT(2047)
     */ ATNAME / ATN,ATNAME(2047)
     */ ATMLUN / ATHLUN
     */ LIBAT / LIBAT
      COMMON /TAT/TAT(3)
C **  CONTIENE - NIL,NOBIND,T -
C
      COMMON/ BUFIO / FCBIN(20),FCBOUT(19),BUFIN(33),BUFOUT(30),
     */STATUS,CARDIN,COMMAR,BUFB(30)
C
      COMMON/ BINSP/ BINSPL,BINSPO,BINSP(16383)
      COMMON / BINSTK / BINSTK(1024)
      COMMON / MMFLAG / MMFLAG
      COMMON / BBBBBB / B
C
COMMON /ERMSG /ERMSG(10,50)
* /NUMER/NUMER
C
 COMMON
*/ ITRACE /ITRACE
C
*/ PTRACE / PTRACE
C
*/ ECHOGC / ECHOGC
CSTAT
CSTAT      COMMON /CONCON/ CONCON
C
 DIMENSION
C    *DATA1(9), DATA4(9),DATA2(20),DATA3(20),
C    *DATA1(14),DATA4(9),DATA2(20),DATA3(20),
*FUN(1284),RETP(1284),CP(1284),BLP(1284),SEGNO(1284),ABP(1284),
*BIND(3072),VAR(3072),BBP(3072),SONBRO(4096),NREENT(4096),
*VALORE(4096),INF(4096),LISTAR(4096),BLINK(4096)
C
 EQUIVALENCE
*(ABLOCK(1),FUN(1)),
*(ABLOCK(2),RETP(1)),
*(ABLOCK(3),CP(1)),
*(ABLOCK(4),BLP(1)),
*(ABLOCK(5),SEGNO(1)),
*(ABLOCK(6),ABP(1)),
*(BBLOCK(1),BIND(1)),
*(BBLOCK(2),VAR(1)),
*(BBLOCK(3),BBP(1)),
*(CBLOCK(1),SONBRO(1)),
*(CBLOCK(2),NREENT(1)),
*(CBLOCK(3),VALORE(1)),
*(CBLOCK(3),INF(1)),
*(CBLOCK(4),LISTAR(1)),
*(CBLOCK(4),BLINK(1)),
*(ZSPAZ,NBLANK)
 DATA ZNILLL/Z05000000/,ZNTYPE/Z01000000/,ZBASE/Z00800000/
 DATA MASK 3B / ZOOFFFFFF /, MASK4B / ZFFOOFFFF /
 DATA MASK5B /ZFFFFOOFF /, MASK6B / ZFFFFFFOO /
 DATA MASK7B / Z000000FF
 DATA UNO/1/
C    *DATA
C    *DATA1/' (LAM','BDA(',') (PR','INT(','APPL','Y(RE','AD ''',
C    *INPU','T)(R','EAD '''INP','UT))','''OUT','PUT>'/ ,
C    *DATA1/' (LAM','BDA(',')(PRINT(','APPL','Y(BE', 'AD) (',
C    *'READ','>    '/,
C    *DATA2/('LAM','BDA(','X Y ', 'Z)<P','UTD<', 'CAR (','SETO', Y (R'
C    *'EAD ','X()Z','>(CD','R Y>* , * (APP", "LY (Q" , "UOTE",
C    *' LOA', 'D) (L','IST ','X() (',')Z> '/'
C    *DATA3/' (LAM','BDA(',')(AP','PLY(','QUOT','E PE','RMES',') (CO',
C    *'NS(G','ETVA','L(QU','OTE ','ERRO','RN))',') () (','GETA','PF(Q',
C    *'UOTE',' LIS',' PX> '/,
C    *DATA4/'(LAM','BDA(','$$$$','$$$X',')($$','EVAL','$$ $',
C    *'$$$$','$$X>'/
 DATA NBLANK/'        '
 C
C     NOMI DI ATOMI
C
      B = 0
      MMFLAG = 0
C
      ECHOGC = 1
      ZNIL = ZNILLL
      ISW1=0
      OSW1=0
C  **** AZZERAMENTO  CONTROLLO - INIZ. ASIZE, BSIZE, CSIZE.
      ASIZE=642*6
      ASIZE=ASIZE*2
      BSIZE=1536*3
       BSIZE=BSIZE* 2
      CSIZE=1536*4
       CSIZE=CSIZE*2
C  ******
      DO 2346 I=1,ASIZE
2346  ABLOCK(I) =0
      DO 2347 I=1,BSIZE
2347  BBLOCK(I) =0
      DO 2348 I=1,CSIZE
2348  CBLOCK(I) =0
C  ***************** NOME DELL'ATOMO $ERROR$$ *******
C
C     TIPI
C
      LISTT = 0
      BASEFT = 1
      COMMAT = 2
      NLAMBD = 3
      NNAMBD = 4
      ATOMT = 5
      NAPPID = 6
      CXTT = 7
      COMPT=12
      ARRAYT=13
      REDEFT = 31
      SNUM = 9
      LNUM = 11
      TUPLE = 32
      CLASS = 33
      BAG = 34 
      STR = 30
C
C     COSTANTI VARIE
C
      RUNO = 256
      FLAG = 65536
      UNNO = 65536
      NTYPEE = ZNTYPE
      ATOMT1 = 5*NTYPEE
      NATOML = 6*NTYPEE
      UNNO2 = UNNO/2
      ALMODE = 0
      NREDMO = 0
C
C     MARCHE
C
      COMMAM = COMMAT*NTYPEE
      BASEFM = BASEFT*NTYPEE
      STRC = STR*NTYPEE
C
C     MECCANISMO DEI CONTESTI.
C
      DO 2 I=1,128
      ALIST(I) = -1
      R(I) = 0
      S(I) = 0
      CXTX(I) = 0
      PADRE(I) = 0
      FIRSTS(I) = 0
      FIRSTB (I) = 0
      LIST (I) = I+1
2     CONTINUE
      LIST (128) = -1
      LIB = 1
      R(1) = 1
      S(1) = 1  
      CXTX(1) = 1
      CXT(1) = 1
      KEY(1) = 1
      DO 200 I=2,256
      CXT(I) =0
200   KEY(I) =0
      ACXT = 1 
      CXTC = 1
      CONTAP = 1
      AAK = 1
C *******
      NUMCXT = 1
C *******
      RADIX = 1
      RRADIX = 1
C
C     NUMERI
C
      BASE = ZBASE
      EXES = BASE+SNUM*NTYPEE
C       INIZIALIZZAZIONE  NPRINA
      PRINO=NBLANK
C
CXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX
C     PER AUMENTARE LA LUNGHEZZA DEGLI ATOMI
C     BASTA PORRE :  ATMLUN = 32
C                    ATN = 4
C     E AUMENTARE LA DIMENSIONE DI NPRINA
C     PORTANDOLA DA 6143 A 8191.
CXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX
C
      LZATOM = 2047
      ATMLUN = 24
      ATN = 3
      DO 203 I=1,LZATOM
      APUNT (I) = I+1
203   ATNAME (I) = I*ATN
      LTAT = LZATOM*ATN+ATN-1
      LMAT = LTAT-10*ATN
      LMAT1 = LMAT+ 1
      DO 204 I=1,LMAT
      NPRINA(I) = NBLANK
204   CONTINUE
      DO 205 I=LMAT1,LTAT
      NPRINA(I) = PUNTI(1)
205   CONTINUE
      APUNT(LZATOM) = -2
      AAAPUN = 1
      ATN = 0
      LIBAT = 0
C
C    NUOVA COLLOCAZIONE HASH
C
      REWIND 3
      INNN= 1
      READ(3,78601) NUMATO,NUMER
78601 FORMAT(2I3)
      CALL ASSBLK(PLATO,ATMLUN)
      DO 131 I=1,17
      READ (3, 132) PLATO(1),FDE
      K=INSAT(7171)
      KK=MOD(K,NTYPEE)
      GOTO (141,142,143,144,145,146,147,148,149,150,151,153,154,
     *155,156,157,158),I
141   NIL=K
      OKK=KK
      B5(4)=NIL
      B4(4)=NIL
      DO 192 II=1,LZATOM
      PLIST(II)=NIL
192   FDEF(II)=NIL
      GOTO 131
142   NOBIND=K
      B3(4)=NOBIND
      DO 190 II=1,LZATOM
190   VALUE(II)=NOBIND
      VALUE(OKK)=NIL
      GOTO 131
143   T=K
      VALUE(KK)=T
      GOTO 131
144   LAMBDA=K
      GOTO 131
145   PROG=K
      FDEF(KK) = FDE
      GOTO 131
146   QUOTE=K
      FDEF(KK) = FDE
      GOTO 131
147   EOF = K
      VALUE(KK) = EOF
      GOTO 131
148   NLAMBA = K
      GOTO 131
149   FAULTV = K
      GOTO 131
150   ERREXP = K
      GOTO 131
151   ERRORN = K
      GOTO 131
153   MCONS = K
      FDEF(KK)=FDE
      GOTO 131
154   MEVAL = K
      FDEF(KK)=FDE
      GOTO 131
155   PROGN=K
      FDEF(KK)=FDE
      GOTO 131
156   DCLV=K
      FDEF(KK)=FDE
      GOTO 131
157   EOR = K
      VALUE(KK)=EOR
      GOTO 131
158    DDNARG =K
131   CONTINUE
      TAT(1)=NIL
      TAT(2)=NOBIND
      TAT(3)=T
C
      DO 137 I=18,NUMATO
      CALL ASSBLK(PLATO,ATMLUN)
      READ(3,132) PLATO(1),FDE
      K = INSAT(7171)
      KK = MOD(K,NTYPEE)
      FDEF(KK) = FDE
137   CONTINUE
C
C     INIZZIALIZZAZIONE INDICATORE DI TRACCIA E
C      PUNTATORE ALLA LISTA DI FUNZIONI DA TRACCIARE
C
CSTAT
CSTAT       CONTIN=O
      ITRACE= 1
      PTRACE=NIL
CSTAT
CSTAT       CONCON=1
C
C     BLOCCHI DI CONTROLLO.
C
      FLA = 1
      NAPPOI = 0
      KKK=ASIZE-11
      DO 3 I=1,KKK,6
3     ABP(I) = I+6
      KKK2=ASIZE-5
      ABP(KKK2) = NIL
      KKK=ASIZE-23
      DO 31 I=KKK,KKK2,6
31    RETP(I) =BUFLAG
C
      FLC = 1
      KKK=CSIZE-7
      CPOINT = DO 4 I=1,KKK,4
4     BLINK(I) = I+4
      KKK2=CSIZE-3
      BLINK(KKK 2) = NIL
      KKK=CSIZE-43
      DO 41 I=KKK,KKK2,4
41    NREENT(I)=BUFLAG
C
      FLB = 1
      KKK=BSIZE-5
      BPOINT = 0
      DO 5 I=1,KKK,3
5     BBP(I)=I+3
      KKK2=BSIZE-2
      BBP(KKK2) = NIL
C
C     FREE STORAGE.
C        FSSIZE = 30000
C
C****** AZZERAMENTO CDR
C
      B2(4)=0
      DO 2349 I=1,FSSIZE
2349  CDR(I)=0
      FLFS = 0
      B1(4) = 1
      FSM2 = FSSIZE-1
      DO 6 I=1,FSM2
6     CAR(I) = I+1
      CAR(FSM2+1) = NIL
      FSMBUF=FSM2-200
      PSM1=PSSIZE-1
      DO 61 I=FSMBUF, FSM1
61    CDR(I)=BUFLAG
      CDR(FSM2+1)=BUFLAG
C
C    SPAZIO BINARIO
C
      BINSPL=16383
      LD = 200
      LD1 = LD + 15
      BINSPO = BINSPL + EXES
      BINSP(1) = LD + EXES
      BINSP(2) = LD + 16 + EXES
      DO 1743 I =16,LD1
1743  BINSP(I) = NIL
      BINSP (LD + 16) = BINSPL - ((LD + 16) + 2) + EXES
      BINSP (LD + 17) = EXES
      BINSP (LD + 18) = NIL
C == > MA SCHERE
      BINSP(3) = MASK3B
      BINSP(4) = MASK4B
      BINSP(5) = MASK5B
      BINSP(6) = MASK6B
      BINSP(7) = MASK7B
      BINSP(15)=NIL
C  TRACCIA GARBAGE COLLECTOR
C
      DO 1741 I=1,128
1741  CPLIST(I) = NIL
C
C     PRIMO BUFFER   (LISPX)
C
      LENGTH = 80
C   
      DO 15 I=1,33
15    BUFIN(I) = ZSPAZ
      READ(3,1333) (BUFIN (I) ,I=1,20)
      CALL ASSBLK (PLATO, ATMLUN)
      READ (3, 132) PLATO (1) , FDE
      K=INSAT(7171)
      LISPX = K
      KK = MOD(K,NTYPEE)
      FDEF(KK) = READ(UNO,UNO)+NLAMBD*NTYPEE
C
C
C  PUNTO DI CONTROLLO
C
C     SECONDO CARD BUFFER (LLOAD)
      DO 17 I=1,33
17    BUFIN(I) = ZSPAZ
      READ (3,1333) (BOFIN(I),I=1,20)
      LENGTH=80
      CALL ASSBLK(PLATO,ATMLUN)
      READ (3, 132) PLATO(1),FDE
      K=INSAT(7171)
      KK=MOD(K,NTYPEE)
      FDEF(KK)=READ(UNO,UNO)+NLAMBD*NTYPEE
C
C     PUNTO DI CONTROLLO
C
C     TERZO CARD BUFFER (ERRORX)
      DO 19 I=1,33
19    BUFIN(I) = ZSPAZ
      READ(3,1333) (BUFIN(I),I=1,20)
      LENGTH=80
      CALL ASSBLK(PLATO,ATMLUN)
      READ(3,132) PLATO(1),FDE
      K=INSAT(7171)
      KK=MOD (K, NTYPEE)
      FDEF(KK)=READ(UNO,UNO)+NLAMBD*NTYPEE
      ERRORX = K
1333  FORMAT(20A4)
132   FORMAT(A8,Z8)
C
C
C QUARTO CARD-BUFFER (EVAL)
C
      DO 222 I=1,33
222   BUFIN(I)=ZSPAZ
      READ(3,1333) (BUFIN(I),I=1,20)
      LENGTH=80
      CALL ASSBLK(PLATO,ATMLUN)
      READ(3,132) PLATO(1),FDE
      K=INSAT(7171)
      KK=MOD(K,NTYPEE)
      FDEF(KK)=READ(UNO,UNO)+NLAMBD*NTYPEE
      EVAL=K
C  LETTURA MESSAGGI DI ERRORE
      DO 78602 I=1,NUMER
      READ(3,78603) (ERMSG(K,I),K=1,10)
78603 FORMAT (10A4)
78602 CONTINUE
C
C
C
C ** RICORDARE CHE:
C     PER OGNI ATOMO DA AGGIUNGERE SI DEVE MODIFICARE IL FILE DI
C      INPUT FT03F001
C      CALCOLANDO LO FDEF RELATIVO.IL FILE E' COSI' STRUTTURATO:
C     A8 ((NOME ATOMO), Z8 (VALORE DI FDEF)
C****
C
      FAPMT = 105
1530  FORMAT (1X,A8,Z8)
C    LA SUCCESSIVA SEQUENZA DI ASSEGNAMENTI
C   SERVE PER EVITARE LA RACCOLTA DEGLI ATOMI:
C     NIL, NOBIND, T, LAMBDA, PROG, QUOTE, EOF, NLAMBDA
C     FAULTEVA, ERREXP, ERRORN, CONS, $$EVAL$$
C     PROGN, $$DCL$$$, EOR DAL GARBC.
      DO 484 I45=1,30
484   SYSAT(I45)=0
      SYSAT(1)=NIL
      SYSAT(2)=NOBIND
      SYSAT(3)=T
      SYSAT(4)=LAMBDA
      SYSAT(5) =PROG
      SYSAT(6) =QUOTE
      SYSAT(7) =EOF
      SYSAT(8) =NLAMBA
      SYSAT(9) =FAULTV
      SYSAT(10) =ERREXP
      SYSAT(11) =ERRORN
      SYSAT(12) =MCONS
      SYSAT(13) =MEVAL
      SYSAT(14) =PROGN
      SYSAT(15) =DCLV
      SYSAT(16) =EOR
      SYSAT(17) = DDNARG
C    ******** FINE ASSEGNAMENTI . ************
C
C     ** DISARC - DISOUT ** VENGONO ABILITATE SOLO PER : READ E PRINT.
C
      ISW1 = 0
      OSW1 = 0
C
C      STATO = ROUTINE DI STATO DEGLI ATOMI LETTI.
C
C     CALL STATO
      RETURN
      END
      BLOCK DATA
C CONTIENE I BLOCCHI DI CONTROLLO E I BUFFFER DI I/O
      IMPLICIT INTEGER (A-Z)
      DOUBLE PRECISION KK1,PUNTI
      COMMON / RESTAR / RESTAR
      COMMON / KK1 / KK1
      COMMON /PUNTI / PUNTI(4)
       COMMON /BOFLAG/BUFLAG
      COMMON /BUFIO/FCBIN,INFN1,INPT1,INFM1,INBFAD,INLUN1,INEFF1
     *,INEND1,SPCBI1,SPCBI2,INFN21,INFN22,INFT21,INFT22,INFM2,INEND2,
     *DUMMY,FCBOUT,OUTFN1,OUTFT1,OUTFM1,OUTBFA,OUTLN 1,OUTEF1,
     *OUTEN1,SPCBO1,SPCBO2,OUFN21,0UPN22,00FT21,00FT22,00TPM2,0UTEN2,
     *BUPIN,BUFOUT,STATUS,CARDN,COMMAN,BUFB
      COMMON
     */PPDEM /PPDEM
     */ CXTM / CXTM
      DOUBLE PRECISION FCBIN,INFN1,INFT1
      DOUBLE PRECISION FCBOUT,OUTFN1,OUTFT1
      DIMENSION BUFIN(33),BUFOUT(30),BUFB(30)
      DATA FCBIN,INFT1,INFM1,INLUN1,INEFF1,INEND1,
     *SFCBI1,SFCBI2,INFT21,INFT22,INFM2,INEND2/
     *'        ', 'LISP   ',ZC1F10000,80,ZC6400001,0
     *,'STAT','E    ','LISP','    ',ZC1F10000,0/
      DATA FCBOUT,OUTFT1,OUTFM1,OUTLN1,OUTEF1,OUTEN1,
     *SFCBO1,SFCB02,OUFT21,OUFT22,OUTFM2,OUTEN2/
     *'        ','LISP    ',ZC1F10000,80,ZC6400001,0
     *,'STAT','E   ','LISP','    ',ZC1F10000,0/
      DATA BUFB/ 30 *'    '/,RESTAR/0/ 
      DATA PUNTI/'........','........','........','........'/
      DATA
      *PPDEM /Z06000000/,CXTM /Z07000000/
      DATA KK1/'LISP    '/
      DATA BUFLAG /Z7FFFFFFF/
      END
