      SUBROUTINE CSETUP
      IMPLICIT INTEGER(A-Z)
      COMMON /LISTT/LISTT/NIL/NIL/NTYPEE/NTYPEE/SNUM/SNUM/EXES/EXES
      COMMON /NEVALV/NEVALV
      INTEGER*2 LISTT,TIP,SNUM,NENTPO
C------------------------------------------------------------------------
      INTEGER*2 INDMAX
      COMMON / INDMAX / INDMAX
      COMMON / BBBBBB / B
      COMMON / BINSTK / BINSTK(1024)
      COMMON / DDNARG/ DDNARG
C------------------------------------------------------------------------
      COMMON /CAR/ADV1(3),CARO,CAR(15767)/CDE/ADV2(3),CDRO,CDR(15767)
      COMMON /BINSP/BINSPL,BINSPO,BINSP(1023)
      COMMON /CBLOCK/ADV3(3),CBLOCK(4096)/CPOINT/CPOINT
      DIMENSION SONBRO(1),BLINK(1),INF(1),NREENT(1),VALORE(1)
      EQUIVALENCE (CBLOCK(1),SONBRO(1)),(CBLOCK(4),BLINK(1))
     *      ,(CBLOCK(2),NREENT(1)),(CBLOCK(3),INF(1))
      EQUIVALENCE (CBLOCK(3),VALORE(1))
      COMMON /ALMODE/ALMODE/NENTPO/NENTPO/UNNO/UNNO
      COMMON /SWIRET/SWIRET
      COMMON /COMPFN/COMPFN
      COMMON /MMFLAG/MMFLAG
C
C==XXX
C    MODIFICHE 29/04/80
C==XXX
C
C==> INIZIALIZZA 'B'
C
C     WRITE(6,123) CPOINT,NENTPO
123   FORMAT(1X,2(Z8,2X))
      B = 0
      CALL GETARG
      FELLON=CPOINT
C     WRITE(6,125) BLINK(FELLON)
125   FORMAT('BLINK(FELLON)= ', Z8)
C     WRITE(6,123) CPOINT,NENTPO
C
C==> GLI ARGOMENTI SI TROVANO GIA' SULLO STACK
      B = INDMAX
      SAVE = INDMAX + 1
C  DETERMINAZIONE NUMERO DI ARGOMENTI
      INDMAX = 2
      BINSTK(SAVE) = CAR(INF(CPOINT))
      BINSTK(SAVE+1) = DDNARG
      CALL GETPF
      B = 0
C   ALLINEAMENTO DELLO STACK AL NUMERO PREVISTO DI ARGOMENTI
      IF (NEVALV.EQ.NIL.OR.NEVALV/NTYPEE.NE.SNUM) GOTO 200
      INDMAX = NEVALV - EXES
      DO 110 I = SAVE,INDMAX
110   BINSTK(B + I) = NIL
C  PREDISPOSIZIONE NOME FUNZIONE
      BINSP(8) =CAR(INF(CPOINT))
C ATTIVAZIONE INTERPRETE MM
C     WRITE (6,123) CPOINT, NENTPO
      TMPBLK = BLINK (CPOINT)
C     WRITE (6,500) TMPBLK,SONBRO(TMPBLK),NREENT(TMPBLK),
C    *VALORE(TMPBLK),BLINK(TMPBLK)
500   FORMAT (' C-BLOCK PRIMA' , 5(2X,Z8))
C     WRITE(6,125) BLINK(FELLON)
       CALL MM
C     WRITE (6,125) BLINK(FELLON)
C     WRITE (6,123) CPOINT,NENTPO
C  TEST SULLE RAGIONI DL RITORNO
199   GOTO(220,210,200),MMFLAG
C  MMFLAG = 3
C  RITORNO PER ERRORE
200   MMFLAG=0
      CALL ERROF(50)
      RETURN
C
C==XXX
C  MMFLAG = 2
C  RITORNO PER ATTIVAZIONE FUNZIONE DI BASE
C  ENTRY POINT IN NENTPO
210   CONTINUE
C     WRITE (6,1234)
1234  FORMAT (' ATTIVA FUNZIONE DI BASE')
C     WRITE(6,123) CPOINT,NENTPO
C     WRITE(6,7777) SONBRO(CPOINT),NREENT(CPOINT),VALORE(CPOINT),
C    *BLINK(CPOINT)
      NACTFO = NIL
      SONBRO(CPOINT) = 0
      CALL CPUSV1
C     WRITE(6,123) CPOINT,NENTPO
C     WRITE(6,7777) SONBRO(CPOINT),NREENT(CPOINT),VALORE(CPOINT),
C    *BLINK(CPOINT)
C------------------------------------------------------------------------
C  CPUSV1 AVEVA PREDISPOSTO 2 COME REEENTRY , QUINDI
C  IN QUESTO MODO SI PREDISPONE IL RIENTRO A 146
C------------------------------------------------------------------------
      NREENT(CPOINT) = NREENT(CPOINT) + 144
      CALL CPUSHF
C     WRITE(6,123) CPOINT,NENTPO
C     WRITE(6,7777) SONBRO(CPOINT),NREENT(CPOINT),VALORE(CPOINT),
C    *BLINK (CPOINT)
7777  FORMAT (1X,4(2X,Z8))
      NREENT(CPOINT) = 9999
      INF(CPOINT)= NACTFO
      SWIRET = 1
C     WRITE(6,886) B,INDMAX
886   FORMAT(1X,' VALORE DI B DOPO ATT.FUNZ. DI BASE', 2I5)
      BPIUIN = B+INDMAX
C     WRITE(6,888)  (BINSTK(I),I=1,BPIUIN)
C     WRITE(6,125) BLINK(FELLON)
      RETURN
C  ENTLAB (146)
C
ENTRY CREENT
C     WRITE(6,125) BLINK(FELLON)
C     WRITE(6,1235)
1235  FORMAT(' RITORNA ALL'' INTERPRETE-CODICE COMPILATO')
C     WRITE (6,123) CPOINT,NENTPO
C  RITORNA IN JUMPFF, CHE PRENDE IL VALORE DI NEVALV
      VALORE(CPOINT) = NEVALV
      MMFLAG = 0
      CALL GETARG
C     WRITE(6,125) BLINK(FELLON)
C     WRITE(6,887) B,INDMAX
887   FORMAT (1X,' STACK DOPO GETARG', 2I5)
      BPIUIN = INDMAX + B
C     WRITE (6,888)  (BINSTK(I),I=1,BPIUIN)
888   FORMAT(8(2X,Z8))
C     WRITE(6,123) CPOINT,NENTPO
      CALL MM1
C     WRITE(6,125) BLINK(FELLON)
C     WRITE(6,123) CPOINT,NENTPO
      GOTO 199
C
C==XXX
C  MMFLAG = 1
C  RITORNO DEFINITIVO. -> DELOCAZIONE BLOCCO F
C==XXX
C
220   CONTINUE
C     WRITE(6,700)
700   FORMAT(' RITORNO DEFINITIVO')
C     WRITE(6,123) CPOINT,NENTPO
C     WRITE(6,125) BLINK(FELLON)
      CALL CPOP
C     WRITE(6,125) BLINK(FELLON)
C     WRITE(6,123) CPOINT,NENTPO
C     WRITE(6,7777) SONBRO(CPOINT),NREENT(CPOINT),VALORE(CPOINT),
C    *BLINK(CPOINT)
      SONBRO(CPOINT) = MOD(SONBRO(CPOINT),UNNO)
      SWIRET=2
      MMFLAG=0
      B = 0
      RETURN
      END
